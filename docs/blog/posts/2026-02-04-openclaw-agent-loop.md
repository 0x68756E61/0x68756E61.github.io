---
title: OpenClaw Agent Loop (에이전트 루프)
date: 2026-02-04
authors:
  - '0x68756E61'
categories:
  - Agent Loop
tags:
  - openclawd
  - clawdbot
---

![](../../assets/images/openclaw-agent-loop-hero.png)

> Lead: 에이전트 루프는 입력에서 최종 응답까지의 전체 실행 경로로, 컨텍스트 조립·모델 추론·도구 실행·스트리밍 응답·영속화를 포함합니다.


<!-- more -->

---

## 에이전트 루프(개요)

에이전트 루프는 에이전트의 전체 실행: 입력 → 컨텍스트 조립 → 모델 추론 → 도구 실행 → 스트리밍 응답 → 영속화로 구성됩니다. OpenClaw에서는 각 세션에 대해 단일 직렬화된 런이 수행되며, 라이프사이클 및 스트림 이벤트를 방출합니다.

## 진입점

- Gateway RPC: , 
- CLI:  명령

## 실행 흐름 요약

1. agent RPC가 파라미터를 검증하고 세션을 찾은 뒤 을 반환합니다.
2. agentCommand가 실행되어 모델/스킬 스냅샷을 로드하고 를 호출합니다.
3. runEmbeddedPiAgent는 세션별·전역 큐를 통해 런을 직렬화하고 pi-agent-core 이벤트를 구독하며, 타임아웃을 감시합니다.
4. subscribeEmbeddedPiSession은 도구/어시스턴트 델타 및 라이프사이클 이벤트를 OpenClaw 스트림으로 브리지합니다.

## 큐잉 및 동시성

- 실행은 세션 키별로 직렬화되어 도구/세션 레이스를 방지합니다.
- 메시징 채널은 // 같은 큐 모드를 사용하여 입력을 레인 시스템에 공급합니다.

## 세션 준비 및 프롬프트

- 워크스페이스가 준비되고(샌드박스 필요 시 리디렉션), 스킬과 부트스트랩 컨텍스트가 시스템 프롬프트에 주입됩니다.
- 모델별 토큰 제한과 컴팩션을 적용하여 안정적인 프롬프트가 구성됩니다.

## 훅 포인트

- 내부 훅(Gateway hooks)과 플러그인 훅을 통해 , ,  등에서 실행을 가로챌 수 있습니다.

## 도구 실행 및 응답 형성

- 도구 이벤트는  스트림으로 방출되고 결과는 로깅 전에 정리됩니다.
- 최종 응답은 어시스턴트 텍스트, 인라인 도구 요약, 오류 텍스트로 구성되며 는 필터링됩니다.

## 타임아웃 및 종료 조건

-  기본 대기 시간: 30초
- 런 타임 기본 타임아웃: (기본 600초)
- 조기 종료: 타임아웃, AbortSignal, Gateway 연결 끊김 등

---

### 참고
원문: Agent Loop — OpenClaw docs
